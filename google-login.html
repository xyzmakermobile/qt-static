<!DOCTYPE html>
<html>

<head>
  <title>Google Login for QT</title>
  <meta charset="UTF-8">
</head>

<body>
  <script src="https://apis.google.com/js/api.js?onload=init" async defer></script>
  <script>
    function init() {
			console.log('init()');
			gapi.load('client:auth2', {
				callback: function() {
					// Initialize client library
					// clientId & scope is provided => automatically initializes auth2 library
					gapi.client.init({
							apiKey: 'AIzaSyAw4IEMXkC0xGPmmTKATOtpGOWrp5KLaoo',
							client_id: '278654058843-eogbn1n69rjgre4etrbpjg25neqnlvol.apps.googleusercontent.com',
							scope: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email  https://www.googleapis.com/auth/plus.me'
					}).then(			// On success
				function(success) {
			  		// After library is successfully loaded then enable the login button
			  		checkLogin();
				}, 
				// On error
				function(error) {
					alert('Error : Failed to Load Library');
			  	});
				},
				onerror: function() {
					// Failed to load libraries
				}
			});
			
    }
	  
		function checkLogin(){
			console.log('checkLogin()');
			
			// API call for Google login
			gapi.auth2.getAuthInstance().signIn().then(
				// On success
				function(success) {
					// API call to get user information
					gapi.client.request({ path: 'https://www.googleapis.com/plus/v1/people/me' }).then(
						// On success
						function(success) {
							console.log(success);
							var user_info = JSON.parse(success.body);
							console.log(user_info);

							url = "https://xyzmakermobile.github.io/qt-static/google-info.html?email=" + user_info.emails[0].value + "&name=" + user_info.displayName + "&token=";
							setTimeout("location.href=url", 0);  
						},
						// On error
						function(error) {
							alert('Error : Failed to get user user information');
						}
					);
				},
				// On error
				function(error) {
					alert('Error : Login Failed');
				}
			);
			/*
			var auth2 = gapi.auth2.getAuthInstance();
			var googleuser = auth2.currentUser.get();
			
			auth2.signIn();
			
			if(auth2.isSignedIn.get()){
				console.log('auth2.isSignedIn() true');
			}else{
				console.log('auth2.isSignedIn() false');
			}
			
			if(googleuser.isSignedIn()){
				console.log('googleuser.isSignedIn() true');
				//getUserInfo(googleuser);
			}else{
				console.log('googleuser.isSignedIn() false');
			}
			
			getUserInfo(googleuser);
			*/
		}
	  
    function getUserInfo(googleuser) {
			console.log('getUserInfo()');
			var profile = googleuser.getBasicProfile();

			url = "https://xyzmakermobile.github.io/qt-static/google-info.html?email=" + profile.getEmail() + "&name=" + profile.getName() + "&token=" + googleuser.getAuthResponse().access_token;
			setTimeout("location.href=url", 0);  
    }
		
		
  </script>

</body>

</html>
