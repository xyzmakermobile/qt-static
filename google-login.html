<!DOCTYPE html>
<html>

<head>
  <title>Google Login for QT</title>
  <meta charset="UTF-8">
</head>

<body>
  <script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
  <script>
    function init() {
			console.log('init()');
			gapi.load('client:auth2', {
				callback: function() {
					// Initialize client library
					// clientId & scope is provided => automatically initializes auth2 library
					gapi.client.init({
							apiKey: 'V6HMWqkXpxEKVe5uFCRpa9at',
							client_id: '278654058843-3odoh27jg4shvajnjub447prahq8h0tu.apps.googleusercontent.com',
							scope: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email  https://www.googleapis.com/auth/plus.me'
					}).then(			// On success
				function(success) {
			  		// After library is successfully loaded then enable the login button
			  		checkLogin();
				}, 
				// On error
				function(error) {
					alert('Error : Failed to Load Library');
			  	});
				},
				onerror: function() {
					// Failed to load libraries
				}
			});
			
    }
	  
		function checkLogin(){
			console.log('checkLogin()');
			var auth2 = gapi.auth2.getAuthInstance();
			var googleuser = auth2.currentUser.get();
			if(googleuser.isSignedIn){
				console.log('googleuser.isSignedIn() true');
				getUserInfo(googleuser);
			}else{
				console.log('googleuser.isSignedIn() false');
			}
		}
	  
    function getUserInfo(googleuser) {
			console.log('getUserInfo()');
			var profile = googleuser.getBasicProfile();

			url = "https://xyzmakermobile.github.io/qt-static/google-info.html?email=" + profile.getEmail() + "&name=" + profile.getName() + "&token=" + googleuser.getAuthResponse().access_token;
			setTimeout("location.href=url", 0);  
    }
		
		
  </script>

</body>

</html>
